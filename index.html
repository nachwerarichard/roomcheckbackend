<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotel Management</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const backendURL = 'https://roomcheckbackend-grf6.onrender.com';

    const humanize = (str) =>
      String(str)
        .replace(/_/g, ' ')
        .replace(/\b\w/g, (l) => l.toUpperCase());

    const App = () => {
      const [activeTab, setActiveTab] = React.useState('checklist');
      const [notification, setNotification] = React.useState({ message: '', error: false });
      const [confirmModal, setConfirmModal] = React.useState({ show: false, message: '', onConfirm: () => {} });
      const [isLoading, setIsLoading] = React.useState(false);

      const [checklists, setChecklists] = React.useState([]);
      const [housekeeping, setHousekeeping] = React.useState([]);
      const [inventory, setInventory] = React.useState([]);

      const [newChecklist, setNewChecklist] = React.useState({
        room: '',
        date: '',
        items: { towels: 'yes', toiletries: 'yes', bed_linens: 'yes' },
      });
      const [newHousekeeping, setNewHousekeeping] = React.useState({
        room: '',
        issue: '',
        status: 'pending',
        date: '',
      });
      const [newInventory, setNewInventory] = React.useState({ item: '', quantity: '' });

      const [checklistSearch, setChecklistSearch] = React.useState('');
      const [housekeepingSearch, setHousekeepingSearch] = React.useState('');
      const [inventorySearch, setInventorySearch] = React.useState('');

      const showNotification = (message, isError = false) => {
        setNotification({ message, error: isError });
        setTimeout(() => setNotification({ message: '', error: false }), 3000);
      };

      const showConfirmModal = (message, onConfirm) => {
        setConfirmModal({ show: true, message, onConfirm });
      };

      const hideConfirmModal = () => {
        setConfirmModal({ show: false, message: '', onConfirm: () => {} });
      };

      const fetchData = async () => {
        setIsLoading(true);
        try {
          const [checklistsRes, housekeepingRes, inventoryRes] = await Promise.all([
            fetch(`${backendURL}/checklists`),
            fetch(`${backendURL}/housekeeping`),
            fetch(`${backendURL}/inventory`),
          ]);

          setChecklists(await checklistsRes.json());
          setHousekeeping(await housekeepingRes.json());
          setInventory(await inventoryRes.json());
        } catch (error) {
          console.error('Failed to fetch data:', error);
          showNotification('Failed to load data. Please check the backend connection.', true);
        } finally {
          setIsLoading(false);
        }
      };

      React.useEffect(() => {
        fetchData();
      }, []);

      // ✅ CRUD handlers same as your version (omitted for brevity)

      const filteredChecklists = checklists.filter((entry) => {
        const haystack = `${entry.room} ${entry.date} ${JSON.stringify(entry.items)}`.toLowerCase();
        return haystack.includes(checklistSearch.toLowerCase());
      });
      const filteredHousekeeping = housekeeping.filter((entry) => {
        const haystack = `${entry.room} ${entry.issue} ${entry.status} ${entry.date}`.toLowerCase();
        return haystack.includes(housekeepingSearch.toLowerCase());
      });
      const filteredInventory = inventory.filter((entry) => {
        const haystack = `${entry.item} ${entry.quantity}`.toLowerCase();
        return haystack.includes(inventorySearch.toLowerCase());
      });

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center p-4 font-sans">
          <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl">
            <header className="flex justify-between items-center mb-6">
              <h1 className="text-3xl font-bold text-gray-900">Hotel Management</h1>
              <p className="text-xs text-gray-500">API Backend: <span className="font-mono">{backendURL}</span></p>
            </header>

            {/* ✅ Show notification only when message exists */}
            {notification.message && (
              <div
                className={`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-md ${
                  notification.error ? 'bg-red-500' : 'bg-green-500'
                } text-white`}
              >
                {notification.message}
              </div>
            )}

            {/* ✅ Confirm modal unchanged */}
            {confirmModal.show && (
              <div className="modal-overlay">
                <div className="bg-white p-6 rounded-lg shadow-xl text-center">
                  <p className="text-lg font-semibold mb-4">{confirmModal.message}</p>
                  <div className="flex justify-center space-x-4">
                    <button
                      onClick={confirmModal.onConfirm}
                      className="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600"
                    >
                      Confirm
                    </button>
                    <button
                      onClick={hideConfirmModal}
                      className="bg-gray-300 text-gray-800 px-6 py-2 rounded-md hover:bg-gray-400"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* ✅ Your tab navigation and sections go here (unchanged) */}
          </div>
        </div>
      );
    };

    // ✅ React 18 createRoot
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>

